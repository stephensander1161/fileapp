{"version":3,"sources":["../src/s3.js"],"names":["S3","app","response","file","s3","options","Bucket","s3Bucket","Key","_","get","getObject","createReadStream","filename","attachment","fileObject","pipe","Expires","url","getSignedUrl"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;IAGqBA,E;AAEjB,gBAAYC,GAAZ,EAAiBC,QAAjB,EAA0B;AAAA;;AACtB,aAAKD,GAAL,GAAWA,GAAX;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACH;;;;kCAESC,I,EAAK;AACX,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;AACA,gBAAMC,UAAU;AACZC,wBAAQC,gBADI;AAEZC,qBAAKC,iBAAEC,GAAF,CAAMP,IAAN,EAAY,MAAZ;AAFO,aAAhB;AAIA,mBAAOC,GAAGO,SAAH,CAAaN,OAAb,EAAsBO,gBAAtB,EAAP;AAGH;;;iCACQT,I,EAAK;;AAEV,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;AACA,gBAAMF,WAAW,KAAKA,QAAtB;;AAEA;;AAEA,gBAAMW,WAAWJ,iBAAEC,GAAF,CAAMP,IAAN,EAAY,cAAZ,CAAjB;AACAD,qBAASY,UAAT,CAAoBD,QAApB;;AAEA,gBAAMR,UAAU;AACZC,wBAAQC,gBADI;AAEZC,qBAAKC,iBAAEC,GAAF,CAAMP,IAAN,EAAY,MAAZ;AAFO,aAAhB;AAIA,gBAAMY,aAAaX,GAAGO,SAAH,CAAaN,OAAb,EAAsBO,gBAAtB,EAAnB;;AAEAG,uBAAWC,IAAX,CAAgBd,QAAhB;AAEH;;;uCAEcC,I,EAAK;;AAEhB,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;AACA,gBAAMC,UAAU;AACZC,wBAAQC,gBADI;AAEZC,qBAAKC,iBAAEC,GAAF,CAAMP,IAAN,EAAY,MAAZ,CAFO;AAGZc,yBAAS,IAHG,CAGG;AAHH,aAAhB;;AAMA,gBAAMC,MAAMd,GAAGe,YAAH,CAAgB,WAAhB,EAA6Bd,OAA7B,CAAZ;;AAEA,mBAAOa,GAAP;AAEH;;;;;;kBAlDgBlB,E","file":"s3.js","sourcesContent":["import _ from 'lodash'\r\nimport {s3Bucket} from './config'\r\n\r\n\r\nexport default class S3{\r\n\r\n    constructor(app, response){\r\n        this.app = app;\r\n        this.response = response; \r\n    }\r\n\r\n    getObject(file){\r\n        const s3 = this.app.s3;\r\n        const options = {\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name')\r\n        };\r\n        return s3.getObject(options).createReadStream();\r\n\r\n\r\n    }\r\n    download(file){\r\n\r\n        const s3 = this.app.s3;\r\n        const response = this.response;\r\n\r\n        //get object from s3 service\r\n        \r\n        const filename = _.get(file, 'originalName');\r\n        response.attachment(filename);\r\n\r\n        const options = {\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name')\r\n        };\r\n        const fileObject = s3.getObject(options).createReadStream();\r\n\r\n        fileObject.pipe(response);\r\n\r\n    }\r\n\r\n    getDownloadUrl(file){\r\n\r\n        const s3 = this.app.s3;\r\n        const options = {\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name'),\r\n            Expires: 3600, //one hour \r\n        };\r\n\r\n        const url = s3.getSignedUrl('getObject', options);\r\n\r\n        return url;\r\n\r\n    }\r\n\r\n\r\n}"]}