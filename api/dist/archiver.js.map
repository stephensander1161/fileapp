{"version":3,"sources":["../src/archiver.js"],"names":["FileArchiver","app","files","response","zip","attachment","pipe","s3Downloader","S3","_","each","file","fileObject","getObject","append","name","get","finalize"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;IAEqBA,Y;AAEjB,8BAAYC,GAAZ,EAAsC;AAAA,oBAArBC,KAAqB,uEAAb,EAAa;AAAA,oBAATC,QAAS;;AAAA;;AAElC,qBAAKF,GAAL,GAAWA,GAAX;AACA,qBAAKC,KAAL,GAAaA,KAAb;AACA,qBAAKC,QAAL,GAAgBA,QAAhB;AACH;;;;2CAES;;AAEN,4BAAMF,MAAM,KAAKA,GAAjB;AACA,4BAAMC,QAAQ,KAAKA,KAAnB;AACA;AACA,4BAAME,MAAM,wBAAS,KAAT,CAAZ;AACA,4BAAMD,WAAW,KAAKA,QAAtB;;AAEAA,iCAASE,UAAT,CAAoB,cAApB;AACAD,4BAAIE,IAAJ,CAASH,QAAT;;AAGA,4BAAMI,eAAe,IAAIC,WAAJ,CAAOP,GAAP,EAAYE,QAAZ,CAArB;;AAEAM,yCAAEC,IAAF,CAAOR,KAAP,EAAc,UAACS,IAAD,EAAU;;AAEpB,oCAAMC,aAAaL,aAAaM,SAAb,CAAuBF,IAAvB,CAAnB;;AAEAP,oCAAIU,MAAJ,CAAWF,UAAX,EAAuB,EAACG,MAAMN,iBAAEO,GAAF,CAAML,IAAN,EAAY,cAAZ,CAAP,EAAvB;;AAGA;AACA;AACH,yBATD;;AAWAP,4BAAIa,QAAJ;;AAEA,+BAAO,IAAP;AAGH;;;;;;kBAvCgBjB,Y","file":"archiver.js","sourcesContent":["import archiver from 'archiver'\r\nimport _ from 'lodash'\r\nimport path from 'path'\r\nimport S3 from './s3'\r\n\r\nexport default class FileArchiver{\r\n\r\n    constructor(app, files = [], response){\r\n\r\n        this.app = app;\r\n        this.files = files;\r\n        this.response = response;\r\n    }\r\n\r\n    download(){\r\n\r\n        const app = this.app;\r\n        const files = this.files; \r\n        //const uploadDir = app.get('storageDir')\r\n        const zip = archiver('zip');\r\n        const response = this.response;\r\n\r\n        response.attachment('download.zip');\r\n        zip.pipe(response);\r\n\r\n\r\n        const s3Downloader = new S3(app, response);\r\n       \r\n        _.each(files, (file) => {\r\n\r\n            const fileObject = s3Downloader.getObject(file);\r\n\r\n            zip.append(fileObject, {name: _.get(file, 'originalName')});\r\n            \r\n\r\n            //const filePath = path.join(uploadDir, _.get(file, 'name'));\r\n            //zip.file(filePath, {name: _.get(file, 'originalName')});\r\n        });\r\n\r\n        zip.finalize();\r\n\r\n        return this; \r\n\r\n\r\n    }\r\n}"]}